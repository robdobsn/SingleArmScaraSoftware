# Quick and dirty milling code to drill some holes in a panel
from __future__ import print_function
import serial
import time

class RouterControl:

    def __init__(self):
        self.serialPort = None

    def Open(self, serialPortName):
        # Serial port for robot comms
        if serialPortName is not "":
            try:
                self.serialPort = serial.Serial(serialPortName, baudrate=115200, timeout=3.0)
            except:
                print("Serial port " + serialPortName + " cannot be opened")
                exit(0)
        else:
            print("Serial port cannot be empty")
            exit(0)

    def WriteCmd(self, cmdStr):
        self.serialPort.write(cmdStr)
        self.serialPort.write(b'\r\n')
        rxStr = ""
        gotChevron = False
        for i in range(15000):
            bytesWaiting = 0
            try:
                bytesWaiting = self.serialPort.in_waiting()
            except AttributeError:
                bytesWaiting = self.serialPort.inWaiting()
            if bytesWaiting > 0:
                ch = self.serialPort.read(1).decode("utf-8")
                print(ch, end="")
                if gotChevron:
                    if ch == ">":
                        rsltStr = rxStr
                        return rsltStr
                    else:
                        rxStr += ch
                elif ch == "<":
                    gotChevron = True
            time.sleep(0.001)
        return "Timeout"

    def GoToPoint(self, point):
        cmdStr = "G0 {0:.2f} {1:.2f}".format(point[0], point[1])
        print("Sending", cmdStr)
        rslt = self.WriteCmd(cmdStr)
        print("Result", rslt)

    def Step(self, armIdx, steps):
        cmdStr = "S" + str(armIdx) + " {0:d}".format(steps)
        print("Sending", cmdStr)
        rslt = self.WriteCmd(cmdStr)
        print("Result", rslt)

    def Drill(self, doDrill):
        if doDrill:
            cmdStr = "V0 10.0"
        else:
            cmdStr = "V0 0.0"
        print("Sending", cmdStr)
        rslt = self.WriteCmd(cmdStr)
        print("Result", rslt)


batOutlinePoints = [
    [4.501693, 32.209405, 0.0],[6.554918, 31.946409, 0.0],[8.487224, 32.688767, 0.0],[10.076201, 34.015437, 0.0],
    [10.972057, 35.88154, 0.0],[10.761726, 37.940826, 0.0],[9.763341, 39.754146, 0.0],[8.485961, 41.383011, 0.0],
    [10.52521, 41.027535, 0.0],[12.267153, 39.909261, 0.0],[13.906055, 38.644785, 0.0],[15.37165, 37.18296, 0.0],
    [16.614563, 35.527646, 0.0],[17.661677, 33.742022, 0.0],[18.531526, 31.863655, 0.0],[19.207161, 29.907021, 0.0],
    [19.674219, 27.8904, 0.0],[19.922269, 25.835316, 0.0],[19.945873, 23.765451, 0.0],[19.74516, 21.705205, 0.0],
    [19.325782, 19.678132, 0.0],[18.698268, 17.705538, 0.0],[17.876922, 15.805462, 0.0],[16.854088, 14.00582, 0.0],
    [15.63849, 12.330344, 0.0],[14.255131, 10.790468, 0.0],[12.702171, 9.421813, 0.0],[10.962991, 8.299248, 0.0],
    [11.558234, 10.281818, 0.0],[12.540634, 12.103847, 0.0],[13.073751, 14.104019, 0.0],[13.074049, 16.174019, 0.0],
    [12.382265, 18.125002, 0.0],[10.319134, 18.293501, 0.0],[8.756659, 16.935719, 0.0],[7.723393, 15.142046, 0.0],
    [6.576421, 16.865228, 0.0],[5.995555, 18.852058, 0.0],[4.07789, 19.631457, 0.0],[2.812871, 17.992974, 0.0],
    [1.900939, 16.134674, 0.0],[1.237007, 14.174037, 0.0],[0.635916, 12.193232, 0.0],[0.098021, 10.19434, 0.0],
    [-0.721135, 12.095362, 0.0],[-1.310417, 14.079713, 0.0],[-1.994545, 16.033393, 0.0],[-2.871206, 17.908591, 0.0],
    [-4.101999, 19.572937, 0.0],[-6.057316, 18.8935, 0.0],[-6.705574, 16.927626, 0.0],[-7.048689, 14.886261, 0.0],
    [-8.494477, 16.367679, 0.0],[-9.841972, 17.939034, 0.0],[-11.854503, 18.423406, 0.0],[-13.14168, 16.802272, 0.0],
    [-13.305115, 14.738734, 0.0],[-12.898023, 12.709158, 0.0],[-12.008294, 10.840126, 0.0],[-10.912576, 9.083908, 0.0],
    [-12.93821, 9.510176, 0.0],[-14.492802, 10.876977, 0.0],[-15.863293, 12.428317, 0.0],[-17.046535, 14.126798, 0.0],
    [-18.042134, 15.941648, 0.0],[-18.850334, 17.847354, 0.0],[-19.470993, 19.822115, 0.0],[-19.90428, 21.84626, 0.0],
    [-20.07648, 23.909085, 0.0],[-19.993312, 25.977414, 0.0],[-19.751783, 28.033275, 0.0],[-19.295424, 30.052343, 0.0],
    [-18.60326, 32.003191, 0.0],[-17.705231, 33.86825, 0.0],[-16.646945, 35.647275, 0.0],[-15.361882, 37.270085, 0.0],
    [-13.881192, 38.716618, 0.0],[-12.254034, 39.996171, 0.0],[-10.515006, 41.118973, 0.0],[-8.680731, 42.078313, 0.0],
    [-9.559682, 40.204188, 0.0],[-10.657352, 38.449189, 0.0],[-11.162232, 36.441704, 0.0],[-10.530289, 34.470524, 0.0],
    [-9.070217, 33.003183, 0.0],[-7.217935, 32.079088, 0.0],[-5.172067, 31.763935, 0.0],[-4.299535, 33.641057, 0.0],
    [-3.992677, 35.688187, 0.0],[-3.743213, 37.7431, 0.0],[-3.52807, 39.801889, 0.0],[-3.321159, 41.861522, 0.0],
    [-3.044258, 43.912918, 0.0],[-2.020332, 42.113897, 0.0],[-1.198958, 40.213833, 0.0],[0.856909, 39.972353, 0.0],
    [1.780854, 41.82471, 0.0],[2.649713, 43.703535, 0.0],[3.219862, 41.713603, 0.0],[3.41985, 39.653286, 0.0],
    [3.636929, 37.5947, 0.0],[3.882326, 35.539298, 0.0],[4.188339, 33.492042, 0.0]
]

batSpeakerGrillPoints = [
    # [6.000155, 25.816089, 0.0], [7.751163, 26.066329, 0.0], [9.452577, 26.549207, 0.0], [11.070858, 27.262612, 0.0],
    # [12.571857, 28.197748, 0.0], [13.528641, 27.929811, 0.0], [13.863793, 26.19316, 0.0], [13.96254, 24.427278, 0.0],
    # [12.608755, 24.396578, 0.0], [10.844957, 24.497544, 0.0], [9.117801, 24.293174, 0.0], [7.636078, 25.25417, 0.0],
    # [-6.260487, 25.800757, 0.0], [-7.919129, 25.197869, 0.0], [-9.393896, 24.278791, 0.0], [-11.147353, 24.493936, 0.0],
    # [-12.906905, 24.335031, 0.0], [-14.060206, 24.566091, 0.0], [-13.934659, 26.331128, 0.0],
    # [-13.617565, 28.071104, 0.0], [-12.596144, 28.147758, 0.0], [-11.088919, 27.222401, 0.0],
    # [-9.470319, 26.509468, 0.0], [-7.769857, 26.023311, 0.0], [0.806358, 30.67823, 0.0], [1.555158, 29.076103, 0.0],
    # [2.83854, 27.922914, 0.0], [4.588746, 27.725519, 0.0], [6.353107, 27.861176, 0.0], [8.08666, 28.209002, 0.0],
    # [9.740951, 28.832811, 0.0], [11.267888, 29.723739, 0.0], [12.616341, 30.866631, 0.0], [13.734195, 32.235688, 0.0],
    # [14.556748, 30.987486, 0.0], [15.197734, 29.338566, 0.0], [15.652386, 27.628928, 0.0], [15.907682, 25.878452, 0.0],
    # [15.955999, 24.110133, 0.0], [15.796997, 22.3483, 0.0], [15.401965, 20.757504, 0.0], [14.0103, 21.838079, 0.0],
    # [12.344138, 22.412782, 0.0], [10.580951, 22.470988, 0.0], [8.873775, 22.026591, 0.0], [7.534106, 22.989395, 0.0],
    # [5.954766, 23.769049, 0.0], [4.202754, 23.91974, 0.0], [2.524035, 23.392412, 0.0], [1.11282, 22.3345, 0.0],
    # [-0.018724, 20.976456, 0.0], [-1.136818, 22.274457, 0.0], [-2.544497, 23.337458, 0.0], [-4.213613, 23.898395, 0.0],
    # [-5.970237, 23.814785, 0.0], [-7.567909, 23.076149, 0.0], [-8.886173, 22.017788, 0.0], [-10.593991, 22.458172, 0.0],
    # [-12.357458, 22.402958, 0.0], [-14.033259, 21.853966, 0.0], [-15.452695, 20.81055, 0.0],
    # [-15.916057, 22.261183, 0.0], [-16.075428, 24.020287, 0.0], [-15.996221, 25.788259, 0.0],
    # [-15.777099, 27.543909, 0.0], [-15.355778, 29.261731, 0.0], [-14.714483, 30.910243, 0.0],
    # [-13.8958, 32.308548, 0.0], [-12.788424, 30.931479, 0.0], [-11.444599, 29.783021, 0.0], [-9.927335, 28.87528, 0.0],
    # [-8.284679, 28.221155, 0.0], [-6.557632, 27.843279, 0.0], [-4.79176, 27.781017, 0.0], [-3.097375, 28.253118, 0.0],
    # [-1.72033, 29.345992, 0.0], [-0.848701, 30.876601, 0.0], [-0.424475, 32.593016, 0.0], [-0.141338, 34.340064, 0.0],
    # [0.105326, 33.66999, 0.0], [0.423767, 31.929261, 0.0], [2.654026, 31.443817, 0.0], [3.575391, 29.958374, 0.0],
    # [5.309923, 29.772879, 0.0], [7.062073, 30.010138, 0.0], [8.737401, 30.571963, 0.0], [10.262174, 31.464306, 0.0],
    # [11.555412, 32.66717, 0.0], [12.546036, 34.129685, 0.0], [12.974835, 35.834085, 0.0], [13.613116, 36.149791, 0.0],
    # [14.715453, 34.766807, 0.0], [15.647009, 33.262621, 0.0], [16.438022, 31.679888, 0.0], [17.075861, 30.029557, 0.0],
    # [17.548455, 28.324576, 0.0], [17.846108, 26.580577, 0.0], [17.961892, 24.815164, 0.0], [17.894187, 23.047252, 0.0],
    # [17.644785, 21.29569, 0.0], [17.220409, 19.578066, 0.0], [16.630782, 17.909877, 0.0], [15.887258, 16.304346, 0.0],
    # [15.110929, 15.238669, 0.0], [14.987395, 17.002552, 0.0], [14.447361, 18.679101, 0.0], [13.257203, 19.963063, 0.0],
    # [11.587448, 20.494599, 0.0], [9.846772, 20.259447, 0.0], [8.324541, 19.373573, 0.0], [7.359308, 20.392446, 0.0],
    # [6.051437, 21.568729, 0.0], [4.35107, 21.922569, 0.0], [2.782632, 21.155407, 0.0], [1.618603, 19.827903, 0.0],
    # [0.703377, 18.314392, 0.0], [-0.024576, 16.702087, 0.0], [-0.724576, 18.110713, 0.0], [-1.588584, 19.654118, 0.0],
    # [-2.713609, 21.014537, 0.0], [-4.242506, 21.86888, 0.0], [-5.969051, 21.700825, 0.0], [-7.317305, 20.577635, 0.0],
    # [-8.234362, 19.186191, 0.0], [-9.685038, 20.184099, 0.0], [-11.414371, 20.492684, 0.0], [-13.120105, 20.07455, 0.0],
    # [-14.420531, 18.905818, 0.0], [-15.085157, 17.274518, 0.0], [-15.312191, 15.522095, 0.0],
    # [-16.001243, 16.333709, 0.0], [-16.741984, 17.940538, 0.0], [-17.331923, 19.608692, 0.0],
    # [-17.770918, 21.322795, 0.0], [-18.04882, 23.069796, 0.0], [-18.052791, 24.838732, 0.0],
    # [-17.929152, 26.604049, 0.0], [-17.65771, 28.352398, 0.0], [-17.199148, 30.060946, 0.0],
    # [-16.54962, 31.706533, 0.0], [-15.744967, 33.282493, 0.0], [-14.809607, 34.783926, 0.0],
    # [-13.67862, 36.143783, 0.0], [-13.094216, 35.637256, 0.0], [-12.543571, 33.962378, 0.0],
    # [-11.533848, 32.515277, 0.0], [-10.20261, 31.354254, 0.0], [-8.660642, 30.490987, 0.0], [-6.980051, 29.94487, 0.0],
    # [-5.223324, 29.761485, 0.0], [-3.577707, 30.311835, 0.0], [-2.652649, 31.789854, 0.0], [-2.29056, 33.521575, 0.0],
    # [-2.03078, 35.272327, 0.0], [-1.810713, 37.028554, 0.0], [-0.886239, 37.972353, 0.0], [0.883761, 37.972353, 0.0],
    # [1.701519, 36.908849, 0.0], [1.915935, 35.151905, 0.0], [2.174059, 33.400926, 0.0], [2.566354, 31.676737, 0.0],
    # [4.501693, 32.209405, 0.0], [6.131741, 31.867555, 0.0], [7.827822, 32.356521, 0.0], [9.33335, 33.276141, 0.0],
    # [10.501473, 34.596516, 0.0], [10.997184, 36.262203, 0.0], [10.74066, 37.988101, 0.0], [9.901676, 39.544484, 0.0],
    # [8.839459, 40.95826, 0.0], [8.227924, 42.259486, 0.0], [9.800719, 41.450927, 0.0], [11.318049, 40.539843, 0.0],
    # [12.779783, 39.542349, 0.0], [14.152704, 38.426394, 0.0], [15.389739, 37.162031, 0.0], [16.462669, 35.755556, 0.0],
    # [17.3881, 34.24738, 0.0], [18.18653, 32.668269, 0.0], [18.848094, 31.027148, 0.0], [19.362889, 29.334279, 0.0],
    # [19.722729, 27.601872, 0.0], [19.921712, 25.843731, 0.0], [19.956668, 24.074715, 0.0], [19.827406, 22.310076, 0.0],
    # [19.536718, 20.564729, 0.0], [19.090135, 18.852597, 0.0], [18.495488, 17.186055, 0.0], [17.762189, 15.575664, 0.0],
    # [16.878179, 14.043104, 0.0], [15.85316, 12.600835, 0.0], [14.704462, 11.254982, 0.0], [13.43481, 10.022807, 0.0],
    # [12.033725, 8.943284, 0.0], [10.476038, 8.190001, 0.0], [11.236914, 9.747135, 0.0], [12.126682, 11.277035, 0.0],
    # [12.843408, 12.892323, 0.0], [13.103544, 14.637249, 0.0], [13.051088, 16.405046, 0.0], [12.46249, 18.044714, 0.0],
    # [10.820937, 18.462692, 0.0], [9.315519, 17.576663, 0.0], [8.250927, 16.16925, 0.0], [7.417796, 14.608715, 0.0],
    # [6.822701, 15.585096, 0.0], [6.480385, 17.321588, 0.0], [5.911779, 18.98283, 0.0], [4.528176, 19.915874, 0.0],
    # [3.271154, 18.700874, 0.0], [2.36946, 17.179723, 0.0], [1.684997, 15.548893, 0.0], [1.140146, 13.864887, 0.0],
    # [0.629234, 12.170254, 0.0], [0.175225, 10.459835, 0.0], [-0.431081, 11.077004, 0.0], [-0.922168, 12.777478, 0.0],
    # [-1.433578, 14.471946, 0.0], [-2.035858, 16.135903, 0.0], [-2.780005, 17.740987, 0.0], [-3.75161, 19.216366, 0.0],
    # [-5.241537, 19.821122, 0.0], [-6.299684, 18.427656, 0.0], [-6.745214, 16.718452, 0.0], [-7.030554, 14.971801, 0.0],
    # [-7.874259, 15.188537, 0.0], [-8.739062, 16.728838, 0.0], [-9.942062, 18.019237, 0.0], [-11.598104, 18.473322, 0.0],
    # [-12.930595, 17.458767, 0.0], [-13.298716, 15.735383, 0.0], [-13.223643, 13.970689, 0.0],
    # [-12.732318, 12.274365, 0.0], [-11.925516, 10.700823, 0.0], [-10.984122, 9.20201, 0.0], [-10.999017, 8.266301, 0.0],
    # [-12.505988, 9.191193, 0.0], [-13.885179, 10.29897, 0.0], [-15.132053, 11.554042, 0.0], [-16.243101, 12.93096, 0.0],
    # [-17.21722, 14.408032, 0.0], [-18.054338, 15.966917, 0.0], [-18.754591, 17.591938, 0.0], [-19.3179, 19.269389, 0.0],
    # [-19.743812, 20.986893, 0.0], [-20.02654, 22.733432, 0.0], [-20.06563, 24.501712, 0.0],
    # [-19.970333, 26.268921, 0.0], [-19.753154, 28.025059, 0.0], [-19.378673, 29.754261, 0.0],
    # [-18.830962, 31.436573, 0.0], [-18.122397, 33.057902, 0.0], [-17.285952, 34.617383, 0.0],
    # [-16.323826, 36.10176, 0.0], [-15.18831, 37.458251, 0.0], [-13.915196, 38.686889, 0.0],
    # [-12.534506, 39.793537, 0.0], [-11.068483, 40.784565, 0.0], [-9.533839, 41.665756, 0.0],
    # [-8.195539, 41.931736, 0.0], [-9.296936, 40.547875, 0.0], [-10.307592, 39.09621, 0.0], [-11.02442, 37.483843, 0.0],
    # [-11.076175, 35.732893, 0.0], [-10.304246, 34.155825, 0.0], [-9.00831, 32.960235, 0.0], [-7.437422, 32.154762, 0.0],
    # [-5.713956, 31.776456, 0.0], [-4.495052, 32.652967, 0.0], [-4.175956, 34.39361, 0.0], [-3.93219, 36.146715, 0.0],
    # [-3.725586, 37.904585, 0.0], [-3.541949, 39.66503, 0.0], [-3.365121, 41.426175, 0.0], [-3.17581, 43.185982, 0.0],
    # [-2.520681, 43.236209, 0.0], [-1.804372, 41.617666, 0.0], [-1.103651, 39.992278, 0.0], [0.65323, 39.972353, 0.0],
    # [1.564257, 41.313161, 0.0], [2.253838, 42.940482, 0.0], [3.026872, 43.384595, 0.0], [3.228173, 41.626351, 0.0],
    # [3.398674, 39.864584, 0.0], [3.581147, 38.10402, 0.0], [3.781451, 36.345402, 0.0], [4.012323, 34.590565, 0.0],
    # [4.317128, 32.847422, 0.0], [-0.17624, 28.074732, 0.0], [0.941383, 26.713555, 0.0], [2.513248, 25.934175, 0.0],
    # [2.314245, 25.493378, 0.0], [0.763351, 24.649673, 0.0], [-0.605421, 24.458694, 0.0], [-2.125402, 25.357772, 0.0],
    # [-3.817426, 25.86088, 0.0], [-2.377542, 26.379417, 0.0], [-0.89757, 27.339846, 0.0]

    [4.501693, 32.209405, 0.0], [6.831924, 32.012763, 0.0], [9.066105, 33.067279, 0.0], [10.699832, 34.916022, 0.0],
    [10.967535, 37.350054, 0.0], [9.881583, 39.575479, 0.0], [8.362829, 41.540218, 0.0], [9.537527, 41.599607, 0.0],
    [11.665236, 40.31599, 0.0], [13.66832, 38.846933, 0.0], [15.437845, 37.105966, 0.0], [16.891218, 35.092844, 0.0],
    [18.075295, 32.909176, 0.0], [18.993258, 30.601175, 0.0], [19.617665, 28.197223, 0.0], [19.928731, 25.733141, 0.0],
    [19.916666, 23.249549, 0.0], [19.583133, 20.788374, 0.0], [18.940917, 18.389058, 0.0], [18.011913, 16.085398, 0.0],
    [16.797655, 13.919224, 0.0], [15.307977, 11.931755, 0.0], [13.578194, 10.149706, 0.0], [11.592737, 8.660446, 0.0],
    [10.960171, 9.294306, 0.0], [12.21377, 11.4399, 0.0], [13.036922, 13.770284, 0.0], [13.067137, 16.251348, 0.0],
    [12.008762, 18.36728, 0.0], [9.686367, 17.902258, 0.0], [8.1422, 15.976132, 0.0], [6.955876, 14.762879, 0.0],
    [6.50505, 17.206606, 0.0], [5.536193, 19.446908, 0.0], [3.546065, 19.065633, 0.0], [2.255982, 16.947396, 0.0],
    [1.380149, 14.623892, 0.0], [0.651788, 12.247699, 0.0], [-0.11847, 9.991652, 0.0], [-0.803194, 12.374799, 0.0],
    [-1.525807, 14.752684, 0.0], [-2.440226, 17.062259, 0.0], [-3.723198, 19.183132, 0.0], [-5.728264, 19.361824, 0.0],
    [-6.672259, 17.094381, 0.0], [-7.108598, 14.648755, 0.0], [-8.345035, 16.123924, 0.0], [-9.936705, 18.015071, 0.0],
    [-12.270398, 18.262079, 0.0], [-13.266904, 16.079899, 0.0], [-13.155549, 13.607692, 0.0],
    [-12.265201, 11.295865, 0.0], [-10.96845, 9.176251, 0.0], [-11.651133, 8.626968, 0.0], [-13.653731, 10.094143, 0.0],
    [-15.399178, 11.860192, 0.0], [-16.876336, 13.856625, 0.0], [-18.083375, 16.027396, 0.0],
    [-19.020523, 18.327793, 0.0], [-19.687295, 20.720692, 0.0], [-20.060233, 23.175362, 0.0],
    [-20.014725, 25.659187, 0.0], [-19.735769, 28.127622, 0.0], [-19.146561, 30.540031, 0.0],
    [-18.224743, 32.846139, 0.0], [-17.041883, 35.030914, 0.0], [-15.573627, 37.032272, 0.0],
    [-13.808843, 38.779409, 0.0], [-11.834739, 40.287069, 0.0], [-9.708737, 41.572382, 0.0],
    [-8.499831, 41.514338, 0.0], [-10.020981, 39.550839, 0.0], [-11.067315, 37.311202, 0.0],
    [-10.773567, 34.894518, 0.0], [-9.140259, 33.053043, 0.0], [-6.90969, 31.98647, 0.0], [-4.637706, 32.174065, 0.0],
    [-4.144168, 34.606084, 0.0], [-3.819169, 37.070045, 0.0], [-3.554529, 39.541281, 0.0], [-3.305526, 42.014164, 0.0],
    [-2.720751, 43.654402, 0.0], [-1.704311, 41.386627, 0.0], [-0.149605, 39.972353, 0.0], [1.52858, 41.233322, 0.0],
    [2.538399, 43.500212, 0.0], [3.186922, 42.051027, 0.0], [3.427507, 39.577313, 0.0], [3.692026, 37.106061, 0.0],
    [4.005079, 34.640554, 0.0], [2.654026, 31.443817, 0.0], [5.186773, 29.764417, 0.0], [8.511032, 30.473454, 0.0],
    [11.308254, 32.391443, 0.0], [12.922633, 35.343201, 0.0], [14.352824, 35.266189, 0.0], [16.124585, 32.35089, 0.0],
    [17.338973, 29.162797, 0.0], [17.919886, 25.80166, 0.0], [17.822286, 22.392198, 0.0], [17.058925, 19.067421, 0.0],
    [15.689927, 15.942529, 0.0], [14.935897, 17.286608, 0.0], [13.115329, 20.047791, 0.0], [9.807486, 20.245098, 0.0],
    [7.408772, 20.327528, 0.0], [4.554988, 21.943563, 0.0], [1.811983, 20.093434, 0.0], [0.14345, 17.121612, 0.0],
    [-1.28549, 19.165111, 0.0], [-3.588626, 21.626663, 0.0], [-6.753666, 21.174955, 0.0], [-8.867538, 19.713104, 0.0],
    [-12.110158, 20.415105, 0.0], [-14.699915, 18.401001, 0.0], [-15.352051, 15.18929, 0.0],
    [-16.863597, 18.247877, 0.0], [-17.812324, 21.525703, 0.0], [-18.049473, 24.922316, 0.0],
    [-17.665761, 28.313429, 0.0], [-16.61675, 31.557743, 0.0], [-14.974575, 34.549481, 0.0],
    [-13.14401, 36.044237, 0.0], [-11.878602, 32.92233, 0.0], [-9.252424, 30.776039, 0.0], [-6.002758, 29.793467, 0.0],
    [-3.014593, 30.964226, 0.0], [-2.174307, 34.255085, 0.0], [-1.742124, 37.643981, 0.0], [1.379558, 37.972353, 0.0],
    [1.965456, 34.782858, 0.0], [0.806358, 30.67823, 0.0], [3.149469, 27.837074, 0.0], [6.991413, 27.955771, 0.0],
    [10.595034, 29.287777, 0.0], [13.456935, 31.844811, 0.0], [15.148347, 29.487154, 0.0], [15.921066, 25.712892, 0.0],
    [15.717114, 21.866108, 0.0], [13.269643, 22.167702, 0.0], [9.471883, 22.24163, 0.0], [6.252596, 23.672436, 0.0],
    [2.515632, 23.38794, 0.0], [-0.209699, 21.177591, 0.0], [-3.138074, 23.613116, 0.0], [-6.886413, 23.478964, 0.0],
    [-10.129324, 22.39003, 0.0], [-13.901207, 21.918684, 0.0], [-15.946646, 22.434118, 0.0],
    [-15.951703, 26.284558, 0.0], [-15.083983, 30.03629, 0.0], [-13.211132, 31.393497, 0.0],
    [-10.197696, 29.013482, 0.0], [-6.538753, 27.840833, 0.0], [-2.798793, 28.41914, 0.0], [-0.65576, 31.512059, 0.0],
    [-0.006882, 34.444812, 0.0], [-6.260487, 25.800757, 0.0], [-8.95551, 24.539064, 0.0], [-11.835991, 24.476255, 0.0],
    [-14.054595, 24.714572, 0.0], [-13.708884, 27.690028, 0.0], [-11.898682, 27.684136, 0.0],
    [-9.18975, 26.411545, 0.0], [-0.17624, 28.074732, 0.0], [1.474623, 26.337979, 0.0], [2.751913, 25.647327, 0.0],
    [0.610729, 24.538317, 0.0], [-1.30217, 24.930574, 0.0], [-3.546822, 25.811377, 0.0], [-2.040088, 26.549316, 0.0],
    [6.000155, 25.816089, 0.0], [8.968624, 26.385909, 0.0], [11.721869, 27.63157, 0.0], [13.586934, 27.699462, 0.0],
    [13.96298, 24.700454, 0.0], [11.628642, 24.498829, 0.0], [8.742035, 24.583996, 0.0]

]

# squarePoints = []
# for i in range(7):
#     for j in range(7):
#         squarePoints.append([(i - 3) * 10, 170 - (j * 10)])

# backForthPoints = []
# for i in range(5):
#     for j in range(10):
#         backForthPoints.append([20-j*2,170])

precalculatedSteps = [
[-865,919],[24,14],[9,27],[-2,33],[-16,34],[-29,26],[-34,16],[-34,10],[27,14],[32,0],[34,-4],[34,-8],[35,-14],[35,-18],
[35,-21],[34,-26],[34,-28],[34,-33],[32,-35],[32,-38],[30,-40],[30,-42],[28,-44],[26,-45],[24,-45],[22,-46],[19,-44],
[13,-41],[-47,55],[-33,51],[-39,48],[-42,43],[-44,34],[-23,-12],[10,-38],[26,-43],[-45,26],[-43,32],[-32,-1],[19,-40],
[28,-42],[35,-45],[38,-48],[44,-50],[-53,37],[-49,38],[-46,33],[-45,28],[-41,19],[-4,-29],[33,-42],[40,-43],[-42,16],
[-42,17],[-25,-11],[23,-42],[43,-41],[49,-38],[51,-34],[54,-32],[-25,-9],[-46,18],[-47,22],[-47,24],[-47,25],[-45,28],
[-43,28],[-42,29],[-39,31],[-36,32],[-33,32],[-30,33],[-26,33],[-22,34],[-18,34],[-13,34],[-9,33],[-3,32],[0,32],
[3,30],[18,-31],[14,-33],[24,-30],[35,-19],[34,-5],[30,6],[23,15],[-20,34],[-26,30],[-27,29],[-26,29],[-25,27],
[-24,28],[33,-12],[33,-16],[24,17],[-15,32],[-15,32],[31,-20],[29,-24],[29,-25],[30,-26],[32,-25]
]

def getUserOkToContinue(promptStr):
    print(promptStr)
    inStr = ""
    try:
        inStr = raw_input("")
    except:
        inStr = input("")

routerYOrigin = 200

router = RouterControl()
router.Open("/dev/ttyAMA0")
router.Drill(False)
router.GoToPoint((0,routerYOrigin-26))

getUserOkToContinue("Position work piece and press enter")

USE_PRE_CALCULATED_STEPS = False

if USE_PRE_CALCULATED_STEPS:
    for aStep in precalculatedSteps:
        router.Step(0, aStep[0])
        router.Step(1, aStep[1])
        time.sleep(0.3)
        router.Drill(True)
        time.sleep(0.1)
        router.Drill(False)
        time.sleep(0.1)
else:

    STOP_BEFORE_FIRST = True
    SKIP_FIRST_N_POINTS = 11
    pointIdx = 0
    drillPoints = []
    for point in batSpeakerGrillPoints:
        # drillPoints.append([(point[0] - batCentreX) * batScaleX, routerYOrigin - ((point[1] - batMaxY) * batScaleY)])
        drillPoints.append([point[0], routerYOrigin - point[1]])

    for drillPoint in drillPoints:
        # cmdStr = "G0 {0:.0f} {1:.0f}".format(drillPoint[0], drillPoint[1])
        # print(cmdStr)
        if pointIdx < SKIP_FIRST_N_POINTS:
            pointIdx += 1
            continue
        router.GoToPoint(drillPoint)
        time.sleep(0.3)
        if STOP_BEFORE_FIRST:
            getUserOkToContinue("Now over 1st point ... press enter")
            STOP_BEFORE_FIRST = False
        router.Drill(True)
        time.sleep(.1)
        router.Drill(False)
        time.sleep(.1)
        pointIdx += 1


